> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/WZTOvUO8axjbSbIf1xqcSw)

有小伙伴问: .NET 托管入口 Main 函数可以修改成别的函数，用来作为程序的入口吗？

答案：当然是可以的。这也算是. NET 里面非常简单的骚操了。本篇来用最新的. NET8 演示下，如何修改 Main 入口。

**1. 简单控制台例子：**

```c#
namespace ConsoleApp1
{
    internal class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("Call Main");
        }
        static void ABC()
        {
            Console.WriteLine("Call ABC");
        }
    }
}
```

例子里面有两个函数：Main 和 ABC。Main 函数是托管入口函数，这里演示下如何把托管入口函数改为 ABC 函数。结果是程序启动会直接打印出 "Call ABC" 字符串，而不是 "Call Main" 字符串。

以上代码运行之后在 bin/Debug/net8.0 目录下生成了 ConsoleApp1.dll 文件，比如我的当前目录如下：  

![](https://mmbiz.qpic.cn/mmbiz_png/E2GaFRlbWhib4NNpUAEicJUamXX40IgMicmeVwvibbOLzuRvRWGTGRSLm8m1kOnuAgDF72FiaP55PgicEvaOWQlxlDsA/640?wx_fmt=png&from=appmsg)

**2. 修改**

我们需要用到一个工具 CFF Explorer_CN(本文底部有这个小工具的下载链接) 解析下 ConsoleApp1.dll 托管动态链接库。它是类似于 PE 查看器的小工具，同时也兼具托管 DLL 的 MSIL 数据查看。如下图：

![](https://mmbiz.qpic.cn/mmbiz_png/E2GaFRlbWhib4NNpUAEicJUamXX40IgMicmiaKDt5XniacPQLvsyuFuXGQXDvkf0dI0alj3RVFnPIPBt8KSQnJvSmCQ/640?wx_fmt=png&from=appmsg)

把 ConsoleApp1.dll 拖入到 CFF Explorer_CN，展开. NET 目录 -》表 -》Method 表。如下图所示：

![](https://mmbiz.qpic.cn/mmbiz_png/E2GaFRlbWhib4NNpUAEicJUamXX40IgMicmx9an1L7r6AuXtDluPET2EjMEbyPkrXJzlS3KIU2jibaojDUIIOJSiaeg/640?wx_fmt=png&from=appmsg)

Method 表里面有三个方法，我们只看前两个方法 Main 和 ABC 。点击下 Main，看到 Main 函数 RVA 的 Value 值是 0000205E

![](https://mmbiz.qpic.cn/mmbiz_png/E2GaFRlbWhib4NNpUAEicJUamXX40IgMicmRFPyBY6kQP98dpHrrTWC6j6P8e7ZwXb2AnnOvt6BZaC9Riauib4Ytib7g/640?wx_fmt=png&from=appmsg)

点击下 ABC 函数，它的 RVA Value 值是 00002050

![](https://mmbiz.qpic.cn/mmbiz_png/E2GaFRlbWhib4NNpUAEicJUamXX40IgMicmXovg1TZ0ZbOTeFz2UZsuEeAWX6DeMGbMoXUZS9kibmyibdWFDTg40ylQ/640?wx_fmt=png&from=appmsg)

知识点来了，JIT 编译 MSIL 的时候根据 RVA 的值，进行定位函数头的位置。既然如此，把 Main 的 RVA Value 改成 ABC 的 RVA Value，把 ABC 的 RVA Value 改成 Main 的 RVA Value。即可进行 Main 函数和 ABC 函数的逻辑调换。

如何改呢？在 Main 的 Value 值处双击，把 Value 改成 ABC 的 RVA Value 值:00002050。同样在 ABC 的 Value 值处双击，把 Value 值改成 Main 的 RVA Value 值：0000205E。如下红框双击即可改动数据。

![](https://mmbiz.qpic.cn/mmbiz_png/E2GaFRlbWhib4NNpUAEicJUamXX40IgMicmibgxiaBhC55ia2icprlJgu1uF6XzVcGmRYEeKyl7R5QJnuZSLv1icUhC9wQ/640?wx_fmt=png&from=appmsg)

记得关闭 ConsoleApp1.dll 的时候保存下，不然改动不会生效。

最后 cmd 切换到 ConsoleApp1.dll 的目录，通过 dotnet 命令运行下下：

```c#
dotnet ConsoleApp1.dll
```

结果如下：  

![](https://mmbiz.qpic.cn/mmbiz_png/E2GaFRlbWhib4NNpUAEicJUamXX40IgMicmGrUia9XDiazpTnzERVWUp1OTBYZGibncB3uPjEXDAicBzf2yHGHQ2Nynuw/640?wx_fmt=png&from=appmsg)

CFF Explorer_CN 中文版下载地址：https://pan.baidu.com/s/1qf7hXzz7qe8wmK6ymS1F8Q。提取码：1688